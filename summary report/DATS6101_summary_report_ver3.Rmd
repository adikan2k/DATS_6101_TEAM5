---
title: "DATS6101_Summary_Report_ver3"
author: "Team 5"
date: "2024-11-01"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    code_folding: hide
---

```{r message=TRUE, include=FALSE, results='asis'}
# Loading the necessary libraries
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(plotly)
library(car)
library(PMCMRplus)
library(here)
library(shiny)
```

```{r message=TRUE, include=FALSE, results='markup'}
# Loading the dataset

dataset <- read_csv("dataset.csv")

# Now viewing the structure of the dataset
str(dataset)
summary(dataset)
```

```{r message=TRUE, include=FALSE, results='markup'}
dataset <- dataset %>% distinct()
```


# Abstract 

Motor vehicle accidents are the leading cause of unintentional injury-related deaths in the U.S., claiming thousands of lives each year. In our quest to understand the underlying causes of these fatal accidents, we've embarked on a deep exploration of the 2022 Fatality Analysis Reporting System (FARS) dataset. This project utilizes Exploratory Data Analysis (EDA) to uncover critical trends and risk factors contributing to fatal crashes across the country.

Through our journey, we aim to expose patterns within temporal, environmental, and road-related factors, with the ultimate goal of proposing strategies to minimize future fatalities and promote safer roads for all.


# Introduction

#### **Background** 

Our team was inspired to choose this topic by the very real and personal impact of road safety. Every day, thousands of people get behind the wheel, whether for work, family, or leisure, often without a second thought about the potential dangers. Yet, motor vehicle accidents remain one of the leading causes of accidental deaths in the U.S., affecting not only victims but entire communities. We saw this project as an opportunity to use data analysis to address a critical issue where our findings could contribute to meaningful safety improvements.

The 2022 Fatality Analysis Reporting System (FARS) dataset caught our attention as a treasure trove of information, offering insights into when, where, and how fatal accidents happen. From the time of day to weather conditions and emergency response times, it presented a unique opportunity to dissect the factors that contribute to these tragedies. With nearly 39,000 observations, we knew we could uncover meaningful patterns that might help policymakers, city planners, and road safety advocates build a safer future.

Our approach to this topic was rooted in a vision: that data, when thoughtfully explored, can lead to life-saving changes. By revealing patterns in accident trends and highlighting critical risk factors, we aim to provide insights that help reduce fatalities and foster safer roads for everyone.


#### **Objectives**

1. **Identify High-Risk Periods:** Analyze temporal patterns to determine when fatal accidents are most likely to occur, such as specific times of day or days of the week, and assess if there's a heightened risk during rush hours or weekends.

2. **Examine Environmental Impacts:** Investigate the influence of weather, lighting, and visibility on the occurrence and severity of accidents to understand the environmental factors contributing to fatal crashes.

3. **Evaluate Infrastructure and Road Conditions:** Assess the role of road type, urban vs. rural settings, and traffic control measures in accident outcomes to identify infrastructure-related risk factors.

4. **Track Trends Over Time:** Analyze monthly and regional trends in fatal accidents to detect increases or decreases in certain areas, informing regional and seasonal safety interventions.

5. **Analyze Emergency Response Effects:** Study the correlation between EMS response times and fatality rates to identify potential improvements in emergency services that could enhance survival chances in critical situations.


#### **Initial research questions**

The backbone of our study lies in answering the following SMART questions:

1. How do temporal factors (time of day and day of the week) influence the frequency and severity of fatal     accidents?
2. What is the relationship between weather and lighting conditions and the occurrence of fatal accidents?
3. How do road conditions (urban vs. rural, road type, and traffic controls) impact the severity of crashes?
4. Are there discernible trends in fatal accidents over time? Has there been an increase or decrease in        fatalities in certain regions?
5. How does EMS arrival time influence the outcome of fatal crashes, and are quicker response times linked     to lower fatality rates?

*These SMART questions were developed by identifying key factors that contribute to road safety and prioritizing those that could lead to actionable insights for reducing road fatalities. Each question addresses a specific element of fatal accidents, aiming to uncover patterns and risk factors that could be directly influenced by policy changes, infrastructure improvements, or emergency response optimizations.*


# Dataset Overview

This study utilized the 2022 Accidents data file from the Fatality Analysis Reporting System (FARS) by the NHTSA, encompassing nearly 39,000 fatal crashes across all 50 states, DC, and Puerto Rico.FARS compiles and reports the characteristics of vehicle collisions on public roads that result in a fatality within 30 days of the crash. Each record represents a fatal crash and includes detailed crash characteristics and environmental conditions, with key variables:

- **Temporal Factors**: Month, day of the week, and hour of the day when accidents occurred.

- **Environmental Factors**: Weather, lighting conditions, and road types

- **Location and Infrastructure**: State, urban/rural classification, road type

- **EMS**: EMS response time

- **Severity Indicators**: Number of fatalities

FARS data is collected through partnerships between the NHTSA and state governments, sourcing information from police reports, death certificates, vehicle registrations, and coroner reports, then coded and validated for accuracy. A limitation of the dataset is its focus solely on fatal accidents in 2022, which restricts analysis of trends and excludes non-fatal incidents and behavioral factors such as driver impairment or fatigue, limiting broader insights into overall road safety.

# Data Preprocessing
Next, we check for duplicate rows. Let's clear them out!
```{r, include=T, results='markup',message=TRUE}
dataset <- dataset %>% distinct()
```

Moving on to handling missing values...
```{r, include=T, results='markup',message=TRUE}
missing_values <- colSums(is.na(dataset))
print(missing_values[missing_values > 0])
```

Drop columns with missing values: x, y (duplicated), and tway_id2 (irrelevant)
```{r}
# Drop columns with missing values
dataset <- dataset %>% 
  select(
    -c("TWAY_ID2",
       "x",
       "y"))
```

Dropping columns with duplicated meaning and irrelevant
```{r, include=T, results='markup',message=TRUE}
dataset <- dataset %>% select(-STATE, -CITY, -COUNTY, -MONTH, -DAYNAME, -DAY_WEEK, -MINUTENAME, -ROUTE, -RUR_URB, -FUNC_SYS, -RD_OWNER, -NHS, -SP_JUR, -LATITUDENAME, -LONGITUDNAME, -MILEPT, -HARM_EV, -MAN_COLL, -MILEPTNAME, -RELJCT1, -RELJCT2, -TYP_INT, -REL_ROAD, -WRK_ZONE, -LGT_COND, -WEATHER, -SCH_BUS, -RAIL, -NOT_MIN, -ARR_MINNAME, -ARR_HOUR, -HOSP_MN, -SCH_BUSNAME, -RAILNAME, -PERNOTMVIT, -VE_FORMS, -PERSONS)

```

Clean the column names
```{r}
# Lets rename columns for consistency
colnames(dataset)<- str_to_lower(colnames(dataset))
colnames(dataset) <- str_replace_all(colnames(dataset), " ", "_")
colnames(dataset)
```

Convert variables into correct data types
```{r}

# Convert some variables into factor variables
dataset$rur_urbname <- factor(dataset$rur_urbname)
dataset$day_weekname <- factor(dataset$day_weekname, levels = c("Sunday","Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
dataset$func_sysname <- factor(dataset$func_sysname)
dataset$lgt_condname <- factor(dataset$lgt_condname)
dataset$weathername <-factor(dataset$weathername)
dataset$statename <- factor(dataset$statename)

str(dataset)
```

# Analysis and Results

## 1. Temporal Analysis

```{r Q1:Create Temporal Subset, include=FALSE}
# Select columns consists of temporal factors (month, day, day_week, hour) and no of fatalities (fatals)
df_temporal <- dataset %>% 
  select("monthname",
         "day",
         "day_weekname",
         "hour",
         "fatals")

# Create a new column to stored the date
df_temporal <- df_temporal %>%
  mutate(
    date = as.Date(paste("2022", monthname, day, sep = "-"), format = "%Y-%b-%d"),
    day_type = ifelse(day_weekname %in% c("Saturday", "Sunday"), "Weekend", "Weekday"),
   fatal_category = ifelse(fatals > 1, "multiple", "one"),
    time_of_day = case_when(
    hour < 6 ~ "Early Morning",
    hour >= 6 & hour <12 ~ "Morning",
    hour >= 12 & hour < 18 ~ "Afternoon",
    hour >= 18 ~ "Evening")) 

# convert into factor variable and set up level
df_temporal$day_weekname <- factor(df_temporal$day_weekname, levels = c("Sunday","Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
df_temporal$time_of_day <- factor(df_temporal$time_of_day, levels = c("Early Morning", "Morning", "Afternoon", "Evening"))

```

```{r include=FALSE}
# Data frame for daily fatalities
df_daily <- df_temporal %>%
  group_by(date, day_weekname) %>%
  summarise(
    total_accidents = n(),
    average_fatals = mean(fatals),
    total_fatals = sum(fatals)
  ) %>% 
  ungroup()


df_daily <- df_temporal %>%
  group_by(date, day_weekname) %>%
  summarise(
    total_accidents = n(),
    average_fatals = mean(fatals),
    total_fatals = sum(fatals)
  ) %>% 
  ungroup()

# convert to the right data type
df_daily$day_weekname <- factor(df_daily$day_weekname, levels =  c("Sunday","Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))

```
### 1.1 Exploratory Data Analysis

#### Overview of Total Accidents and Fatalities
##### Day of Week
```{r include=FALSE}
# Calculate for the frequency of day of week in the data frame
unique_dates <- df_temporal %>%
  select(date, day_weekname) %>%
  distinct()
unique_dates[order(unique_dates$date), ]

# Count the frequency of day of week
day_of_week_counts <- unique_dates %>%
  group_by(day_weekname) %>%
  summarise(count = n())
day_of_week_counts

# Count the frequency of Weekday and weekend
weekday_weekend_counts <- day_of_week_counts %>%
  mutate(category = ifelse(day_weekname %in% c("Saturday", "Sunday"), "Weekend", "Weekday"))

# Summarize the total counts for Weekdays and Weekends
total_weekday_weekend_counts <- weekday_weekend_counts %>%
  group_by(category) %>%
  summarise(total_count = sum(count))
total_weekday_weekend_counts

```

```{r accident_wday summary statistics, echo=FALSE}
df_wday_accidents <- df_temporal %>% 
  group_by(day_weekname) %>% 
  summarise(total_accidents = n(),
            total_fatalities = sum(fatals),
            avg_fatalities = mean(fatals))%>% 
  ungroup()

# Highest/Lowest/Average  Accident Counts
highest_accidents_day <- df_wday_accidents %>%
  filter(total_accidents == max(total_accidents))

lowest_accidents_day <- df_wday_accidents %>%
  filter(total_accidents == min(total_accidents))

avg_accidents_day <- mean(df_wday_accidents$total_accidents)

# Highest/Lowest/Average Fatalities
highest_fatalities_day <- df_wday_accidents %>%
  filter(total_fatalities == max(total_fatalities))

lowest_fatalities_day <- df_wday_accidents %>%
  filter(total_fatalities == min(total_fatalities))

avg_fatalities_day <- mean(df_wday_accidents$total_fatalities)

```

```{r accidents_wday graph, fig.width=6, fig.height=3, echo=FALSE}
df_wday_accidents <- df_wday_accidents %>%
  mutate(day_type = ifelse(day_weekname %in% c("Saturday", "Sunday"), "Weekend", "Weekday"))


# Data Visualization on Occurrence of fatal accidents per day of week
df_temporal %>% ggplot(aes(x= day_weekname, fill = day_type)) +
  geom_bar()+
  labs(x = "Day of the Week", y = "Number of Fatal Accidents", 
       title = "Count of Fatal Accidents by Day of the Week",
       fill = "Day of Week") +  
  scale_fill_manual(values = c("#bfbfbf", "#0072B2"), 
                    labels = c("weekend", "weekday")) +
  theme_minimal()

```

The averages are 5,640 accidents and 6,112 fatalities. Saturdays have the highest counts (7,057 accidents, 7,735 fatalities), while Tuesdays have the lowest (4,914 accidents, 5,292 fatalities), indicating weekends are riskier.

##### Hour of Day
```{r include=FALSE}

# Filter out unknown hour (hour==99)
df_hour <- df_temporal %>% 
  filter(hour != 99)

df_hour_accidents <- df_hour %>% 
  group_by(hour) %>% 
  summarise(total_accidents = n(),
            total_fatalities = sum(fatals))%>% 
  ungroup()

# Highest/Lowest/Average  Accident Counts
top_5_accidents_hr <- df_hour_accidents %>%
  arrange(desc(total_accidents)) %>%
  slice(1:5)

bottom_5_accidents_hr <- df_hour_accidents %>%
  arrange(total_accidents) %>%
  slice(1:5)

avg_accidents_hr <- mean(df_hour_accidents$total_accidents)

# Highest/Lowest/Average Fatalities
top_5_fatalities_hr <- df_hour_accidents %>%
  arrange(desc(total_fatalities)) %>%
  slice(1:5)

bottom_5_fatalities_hr <- df_hour_accidents %>%
  arrange(total_fatalities) %>%
  slice(1:5)

avg_fatalities_hr <- mean(df_hour_accidents$total_fatalities)
```

```{r}
# Count of Fatal Accidents
df_hour %>% ggplot(aes(x= hour, fill = time_of_day)) +
  geom_bar()+
  labs(x = "hour", y = "Number of Fatal Accidents", 
       title = "Count of Fatal Accidents by Hour",
       fill = "time of day")+
  scale_fill_manual(values = c("#999999","#E69F00", "#D55E00", "#0072B2"))+
  theme_minimal()

```

The frequency graph shows fatal accidents decline from midnight to 6 AM, remain low until noon, peak at 6 PM, and slightly decrease after 9 PM. The averages are 1,632 accidents and 1,769 fatalities. The highest counts occur from 6–10 PM, while the lowest are at 3–4 AM and 8–10 AM, reflecting a consistent daily pattern.


#### Daily Fatalities

```{r echo=FALSE}
# Top 5 Highest Daily Fatalities
top_5_highest_daily_fatal = head(df_daily[order(df_daily$total_fatals, decreasing = TRUE), ], 5)
```

```{r Day of Week: data viz}
# names of days of week
df_daily <- df_daily %>%
  mutate(day_type = ifelse(day_weekname %in% c("Saturday", "Sunday"), "Weekend", "Weekday"))


# Boxplot of daily fatlities by day of week
df_daily %>% ggplot(aes(x = day_weekname, y = total_fatals, fill = day_type))+
  geom_boxplot() +
  labs(x = "Day of the Week", 
       y = "Daily Fatalities", 
       title = "Daily Fatalities by Day of the Week")+
  scale_fill_manual(values = c("#bfbfbf","#0072B2"))
```

The boxplot reveals higher and more variable median fatalities on weekends, especially Saturdays, compared to consistent lower counts on weekdays. 

## 1.2 Research Questions and Hypothesis Development

### Research Questions

Our EDA revealed daily patterns in accidents, prompting us to group hours into four time periods: early morning, morning, afternoon, and evening. These observations refined our focus on how time periods and days of the week influence accident frequency and severity, categorizing severity into "one" and "multiple" fatalities due to distribution imbalances.

The EDA suggests that weekends and evening hours have higher accident frequencies and fatalities, indicating a potential influence of both day and time on accident severity. Further testing will confirm these patterns, expanding on prior studies (Farmer & Williams, 2005; Weast, 2018) that identified a weekend effect using primarily descriptive analysis. 

- SMART question 1: Do **day of the week** and **time period of the day** affect the occurrence and fatalities of fatal accidents?
- SMART question 2: Does **day of the week** affect the day to day variation on total fatalities per day?

### 1.3 Hypotheses Development

To address these research questions, we formulated the following hypotheses:

**Occurrence Analysis**

- **H0**: Accidents are evenly distributed across days of the week/time periods of the day.
- **H1**: Accidents are not evenly distributed across days of the week/time periods of the day.
  
**Fatality Analysis**

- **H0**: Fatality distribution is independent of day of the week/time period.
- **H1**: Fatality distribution is  depends on day of the week/time period.

**Daily Fatalities**

- **H0**: Mean fatalities per day are equal across all days of the week.
- **H1**: At least one day has a different mean fatality rate.

## 1.4 Statistical Tests

### Occurrence Analysis

We performed chi-squared goodness of fit tests to determine if accidents are evenly distributed across days and time periods. Results (p < 0.05) show uneven distribution, with significantly more accidents on Saturdays (18.87), Sundays (6.10), and during evenings (33.34) (see Appendix A1).

### Fatality Analysis

Chi-squared independence tests assessed the relationship between accident severity and time variables. Significant associations (day: p = 0.006; time: p = 1e-05) indicate more multiple-fatality accidents on weekends, especially Saturdays, and during early mornings (see Appendix A2).

### Daily Fatalities Analysis

To compare average fatalities across days, we conducted Welch’s ANOVA due to unequal variances. The analysis (F = 42, p < 2e-16; see Appendix A3) and Games-Howell post-hoc tests reveal higher fatalities on Saturdays and Sundays, with Fridays similar to Sundays, while weekdays have lower fatalities.

### 1.5 Insights

Accidents are most frequent on weekends, especially Saturdays, and evenings. Multiple-fatality accidents peak on weekends and early mornings. Saturdays and Sundays show the highest average fatalities, followed by Fridays. These trends highlight weekends as high-risk periods needing targeted interventions.


## 2. Analysis of Envirnomental conditions 


### Bivariate Analysis and Multivariate Analysis : 

This analysis investigates the effects of weather and lighting conditions on fatal accidents, using exploratory, bivariate, and multivariate analysis techniques.

*1. performed an exploratory analysis of the dataset to examine the relationship between weather and lighting conditions and the total fatalities*

*2. Analyzed fatality counts by both weather and lighting conditions using a heatmap*

##### Overview of Weather and Lighting Effects:

1. Exploratory Analysis: We examined fatality counts by weather and lighting conditions and visualized these relationships. Missing values like "Not Reported" were filtered out to focus on relevant data.

2. Grouping and Aggregation: The dataset was grouped by weather and lighting conditions, calculating total fatalities for each.

3. Visualization: Fatalities were plotted by both weather and lighting conditions, and a heatmap was created to show their combined effects.

##### Key Findings:

1.Weather Conditions: Clear weather had the highest fatality count, likely due to higher traffic volumes and faster speeds during clear conditions.

2.Lighting Conditions: Daylight and unlit dark conditions had high fatality rates, suggesting that safety interventions could focus on these times. Improvements could include enhanced lighting in high-risk areas at night.

### Location based Analysis :

We identified the top 10 U.S. states with the highest fatal accidents under adverse weather and poor lighting conditions. States like Florida and Texas topped the list, indicating potential areas for targeted safety measures, such as better lighting, signage, and public awareness during severe weather.

Steps carried out:

1. Filtering for Adverse Conditions
2. Aggregating Fatalities by State
3. Selecting the Top 10 States
4. Creating a Bar Plot where each bar represents a state, ordered by the total fatalities

### **Hypothesis Testing**

**Null Hypothesis H0**: There is no difference in the mean number of fatalities between adverse and clear weather conditions.

**Alternative Hypothesis H1**: There is a difference in the mean number of fatalities between adverse and clear weather conditions. 

1. Two-Sample t-Test (Weather Conditions):

Objective: To compare fatalities between adverse and clear weather conditions.

Results: The t-statistic of -5 and a p-value of 1e-05 led to the rejection of the null hypothesis, concluding that clear weather conditions have significantly higher fatalities than adverse ones. Mean fatalities were 62.3 for adverse and 359.4 for clear weather.

2. ANOVA and Post Hoc Test (Lighting Conditions):

Objective: To assess differences in mean fatalities across lighting conditions.

Results: The ANOVA yielded a p-value of 0.0017, indicating significant differences. The F-statistic (3.52) suggested that lighting conditions influence fatality rates. Tukey's HSD test revealed that "Dark - Not Lighted" had significantly higher fatalities than "Dark - Lighted" (p-value 0.001).
Practical

### Practical Implications :

Recommendation: Improving lighting in areas that are "Dark - Not Lighted" may help reduce fatal accidents, as lighting seems to play a crucial role in accident prevention under dark conditions.
For other lighting conditions, the lack of significant differences suggests that fatalities do not vary considerably across these conditions. This could imply that lighting in conditions like Dawn, Daylight, and Dusk might be sufficient, and improvements in these areas may not have as strong an impact on reducing fatal accidents.



## 3. Analysis of Infrastrcture conditions

**Overview on the effect of road conditions (urban and rural, road type) on the severity of crashes**

#### Bivariate Analysis :

#### Multivariate Analysis :

#### **Tests carried out**

#### 1. chi-square test on the effect of road types







# Conclusion

Fatal accidents are most frequent between 6 pm and 10 pm, particularly on weekends, with late-night hours linked to increased severity. Highways and major arterials report the highest number of fatalities, possibly due to higher speeds and traffic volumes. Clear weather conditions are associated with a higher rate of fatalities, while poorly lit roads also present elevated risks. EMS response times did not significantly impact accident severity, suggesting that preventive safety measures should be prioritized over emergency response.

Given these findings, targeted interventions should address high-risk periods, such as evenings, late nights, and weekends, with a focus on speed control and improving road lighting.

The dataset's limitations, such as its focus only on 2022 fatal accidents and the lack of behavioral data, limit the analysis of broader safety trends and contributing behavioral factors. Future research should include year-over-year comparisons and incorporate behavioral data, such as impaired driving or fatigue, for a more comprehensive understanding of accident dynamics. Additionally, integrating temporal, environmental, and infrastructural factors to explore their interactive effects could further enhance road safety insights.












## 

# References
# Appendix
## Appendix A: Statistical Test Results
### A.1 Chi-squared Goodness of Fit Test Results
- **Days of the Week**
```{r Chi: Accident Day, echo=FALSE}
# chi-squared test on the occurrence of accident
table(df_temporal$day_weekname)

chi_sq_test <- chisq.test(table(df_temporal$day_weekname))
print(chi_sq_test)

# Get observed and expected counts
observed <- chi_sq_test$observed
expected <- chi_sq_test$expected

# Calculate standardized residuals
standardized_residuals <- (observed - expected) / sqrt(expected)
print(standardized_residuals)
```

- **Time periods of the Day**
```{r Chi: Accident Hour, echo=FALSE}
# chi-squared test on the occurrence of accident
table(df_hour$time_of_day)
chisq_result <- chisq.test(table(df_hour$time_of_day))
chisq_result

# Get observed and expected counts
observed <- chisq_result$observed
expected <- chisq_result$expected

# Calculate standardized residuals
standardized_residuals <- (observed - expected) / sqrt(expected)
print(standardized_residuals)
```

### A.2 Chi-squared Test of Independence Results
- **Days of the Week**
```{r Chi: Fatalities Day, echo=FALSE}
# Chi-squared test: hour of day
chi_sq_result <- chisq.test(table(df_temporal$day_weekname, df_temporal$fatal_category))
print(chi_sq_result)

# standardized residuals table
# get the expected and observed values
observed <- chi_sq_result$observed
expected <- chi_sq_result$expected
# calculate the standardized residuals
standardized_residuals <- (observed - expected) / sqrt(expected)
print(standardized_residuals)
```
- **Time periods of the Day**
```{r Chi: Fatalities Hour, echo=FALSE}
# Chi-squared test: hour of day
chi_sq_result <- chisq.test(table(df_temporal$time_of_day, df_temporal$fatal_category))
print(chi_sq_result)

# standardized residuals table
# get the expected and observed values
observed <- chi_sq_result$observed
expected <- chi_sq_result$expected
# calculate the standardized residuals
standardized_residuals <- (observed - expected) / sqrt(expected)
print(standardized_residuals)
```

### A.3 ANOVA Test Results of Fatalities per Day

```{r Day of Week: ANOVA}
# Welch's ANOVA
Wanova_result <- oneway.test(total_fatals ~ day_weekname, data = df_daily, var.equal = FALSE)
Wanova_result
# post hoc test-Games Howell

posthoc_result <- gamesHowellTest(total_fatals ~ day_weekname, data = df_daily)
print(posthoc_result)
```

